name: 001-Parallel ETF Backtest Workflow

on:
  push:
    paths:
      - 'etf_backtest_master.py'
      - '.github/workflows/backtest_workflow.yml'
  workflow_dispatch:
  schedule:
    - cron: '0 10 * * *'

jobs:
  run_backtest:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: ğŸ“¥ 1. æ‹‰å–ä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 

    - name: ğŸ 2. è®¾ç½® Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: ğŸ› ï¸ 3. å®‰è£…ä¾èµ–
      run: pip install backtrader pandas

    - name: âš™ï¸ 4. æ‰§è¡Œå›æµ‹è„šæœ¬
      run: python etf_backtest_master.py

    - name: ğŸ’¾ 5. æäº¤å¹¶æ¨é€ç»“æœ
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action Bot"
        
        # å¿…é¡»ç¡®ä¿æ–‡ä»¶åä¸ Python è„šæœ¬è¾“å‡ºä¸€è‡´
        if [ -f "backtest_results.csv" ]; then
          git add backtest_results.csv
          git commit -m "ğŸ“Š è‡ªåŠ¨æ›´æ–°å›æµ‹æ’åæŠ¥å‘Š [skip ci]" || echo "æ— å˜åŠ¨éœ€è¦æäº¤"
          git pull origin main --rebase
          git push origin main
        else
          echo "âŒ é”™è¯¯ï¼šæœªå‘ç°å›æµ‹ç»“æœæ–‡ä»¶ï¼Œè¯·æ£€æŸ¥ Python æ—¥å¿—"
          exit 1
        fi
