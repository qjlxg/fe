name: ğŸš€ ETF_V9.0

on:
  push:
    paths:
      - 'analyzer_V9.py'
      - '.github/workflows/**'
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 15:15 è¿è¡Œ (UTC 7:15)
    - cron: '15 7 * * *'
  workflow_dispatch: 

jobs:
  trading_system_run:
    env:
      TZ: Asia/Shanghai
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ä¸è´¦æœ¬
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ é…ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          # å·²ç§»é™¤ cache: 'pip'ï¼Œä¸å†æŠ¥é”™

      - name: ğŸ› ï¸ å®‰è£…é‡åŒ–æ ¸å¿ƒä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy akshare

      - name: ğŸ“ˆ æ‰§è¡Œ V9 æ ¸å¿ƒç³»ç»Ÿ
        # è„šæœ¬å°†è‡ªåŠ¨å®Œæˆï¼šæŠ“å–æœ€æ–°æ•°æ® -> åˆ†ææŒä»“ -> æ‰«ææ–°ä¿¡å·
        run: python analyzer_V9.py

      - name: ğŸ’¾ åŒæ­¥è´¦æœ¬ä¸æŠ¥å‘Šè‡³ä»“åº“
        if: always()
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          
          git add portfolio.csv || true
          git add fund_data/*.csv || true
          git add strategy_log.csv || true
          git add *.md || true
          
          if [ -z "$(git status --porcelain)" ]; then
            echo "æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æäº¤ã€‚"
            exit 0
          fi
          
          git commit -m "ğŸ“Š ç³»ç»Ÿè‡ªåŠ¨åŒæ­¥: $(date +'%Y-%m-%d %H:%M')"
          git pull --rebase origin main
          git push origin main
