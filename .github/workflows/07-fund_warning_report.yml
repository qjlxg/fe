name: ğŸ›°ï¸ å¤©

on:
  push:
    paths:
      - 'analyzer_V9.py'        # å½“ä½ ä¿®æ”¹è„šæœ¬æ—¶è§¦å‘
      - '.github/workflows/**'  # å½“ä½ ä¿®æ”¹æ­¤é…ç½®æ—¶è§¦å‘
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 15:35 è¿è¡Œï¼ˆæ”¶ç›˜ååˆ†æå¹¶æ›´æ–°çœ‹æ¿ï¼‰
    # UTC æ—¶é—´ 07:35 ç­‰äºåŒ—äº¬æ—¶é—´ 15:35
    - cron: '35 7 * * *'
  workflow_dispatch:           # æ”¯æŒæ‰‹åŠ¨ç‚¹å‡»è¿è¡ŒæŒ‰é’®

jobs:
  run-and-push:
    runs-on: ubuntu-latest
    
    # å…³é”®è®¾ç½®ï¼šæˆäºˆ Actions å†™å…¥ä»“åº“çš„æƒé™
    permissions:
      contents: write

    steps:
      - name: ğŸ“¥ 1. æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v4
        with:
          # å¿…é¡»è®¾ç½®ä¸º 0 ä»¥è·å–æ‰€æœ‰å†å²è®°å½•ï¼Œä¿è¯ pull --rebase æ­£å¸¸
          fetch-depth: 0

      - name: ğŸ 2. å®‰è£… Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ› ï¸ 3. å®‰è£…ä¾èµ–åº“
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy

      - name: ğŸ“ˆ 4. è¿è¡Œåˆ†æè„šæœ¬
        run: python analyzer_V9.py

      - name: ğŸ’¾ 5. å°†åˆ†æç»“æœæ¨é€å›ç›®å½•
        run: |
          # é…ç½® Git æœºå™¨äººä¿¡æ¯
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          
          # å¼ºåˆ¶å°†ç»“æœæ–‡ä»¶åŠ å…¥æš‚å­˜åŒº
          # å¦‚æœä½ çš„è„šæœ¬ç”Ÿæˆäº†æ–°çš„æ—¥å¿—æˆ–çœ‹æ¿ï¼Œè¿™é‡Œä¼šæ•è·åˆ°
          git add README.md || true
          git add portfolio.csv || true
          git add trade_log.csv || true
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–
          if [ -z "$(git status --porcelain)" ]; then
            echo "ğŸ“¢ æ²¡æœ‰æ£€æµ‹åˆ°åˆ†æç»“æœæ›´æ–°ï¼Œè·³è¿‡æ¨é€ã€‚"
            exit 0
          fi
          
          # æäº¤æ›´æ”¹
          git commit -m "ğŸ“ˆ [è‡ªåŠ¨æ›´æ–°] å¤©æ¢çœ‹æ¿ä¸å®æˆ˜è®°å½•: $(date +'%Y-%m-%d %H:%M')"
          
          # å…³é”®ï¼šå…ˆæ‹‰å–è¿œç¨‹æ”¹åŠ¨é˜²æ­¢å†²çªï¼Œå†æ¨é€
          git pull --rebase origin main
          git push origin main
