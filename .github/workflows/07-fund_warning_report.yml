name: ğŸš€ å®ç›˜ç»©æ•ˆå›æº¯ç‰ˆ V12

on:
  push:
    paths:
      - 'analyzer_V12.py'
      - '.github/workflows/07-fund_warning_report.yml'
  schedule:
    - cron: '55 6 * * *' # åŒ—äº¬æ—¶é—´ 14:55 è¿è¡Œ
  workflow_dispatch: 

jobs:
  run_analysis:
    runs-on: ubuntu-latest
    # å¿…é¡»ç»™ Actions å†™å…¥æƒé™ï¼Œå¦åˆ™æ— æ³•æ›´æ–°ä»“åº“æ–‡ä»¶
    permissions:
      contents: write
      
    steps:
      - name: ğŸ“¥ 1. æ‹‰å–ä»“åº“
        uses: actions/checkout@v4
        with:
          # å–æ¶ˆæµ…å…‹éš†ï¼Œç¡®ä¿ pull --rebase æœ‰è¶³å¤Ÿçš„å†å²è®°å½•è¿›è¡Œåˆå¹¶
          fetch-depth: 0

      - name: ğŸ 2. åˆå§‹åŒ– Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ› ï¸ 3. å®‰è£…ä¾èµ–
        run: pip install pandas numpy openpyxl

      - name: ğŸ“ˆ 4. æ‰§è¡Œå¤šç»´åˆ†æä¸èƒœç‡è¿½è¸ª
        # ç¡®ä¿è¿™é‡Œçš„æ–‡ä»¶åå’Œä½ æœ€æ–°çš„ Python è„šæœ¬åä¸€è‡´
        run: python analyzer_V12.py

      - name: ğŸ’¾ 5. ä¿å­˜ç»“æœä¸å†å²è´¦æœ¬ (ä¿®å¤ Push å†²çª)
        run: |
          git config --global user.name "Quant-Bot"
          git config --global user.email "bot@quant.com"
          
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶æ·»åŠ 
          git add README.md signal_history.csv || echo "éƒ¨åˆ†æ–‡ä»¶æœªç”Ÿæˆ"
          
          # åªæœ‰åœ¨æœ‰å˜åŠ¨æ—¶æ‰æäº¤ï¼Œé¿å…äº§ç”Ÿç©º commit çš„é”™è¯¯
          if git diff --cached --quiet; then
            echo "æ²¡æœ‰å‘ç°å˜åŠ¨ï¼Œè·³è¿‡æ¨é€ã€‚"
          else
            git commit -m "ğŸ“Š ç»©æ•ˆçœ‹æ¿ä¸å†å²æ•°æ®æ›´æ–°: $(date +'%Y-%m-%d %H:%M')"
            
            # ã€æ ¸å¿ƒä¿®å¤ã€‘ï¼šæ¨é€å‰å¼ºåˆ¶æ‹‰å–è¿œç¨‹å˜åŠ¨å¹¶ä»¥ rebase æ–¹å¼åˆå¹¶
            # å³ä½¿ä½ åœ¨ç½‘é¡µç«¯ä¿®æ”¹äº† READMEï¼Œæˆ–è€…å…¶ä»– Action è¿è¡Œè¿‡ï¼Œè¿™é‡Œä¹Ÿèƒ½è‡ªåŠ¨å¤„ç†
            git pull --rebase origin main
            
            # æ¨é€å› main åˆ†æ”¯
            git push origin main
          fi
