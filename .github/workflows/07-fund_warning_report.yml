name: ğŸš€ å¤©æ¢ V10.2 è‡ªåŠ¨åŒ–å®æˆ˜é—­ç¯

on:
  # è§¦å‘æœºåˆ¶ 1ï¼šä»£ç æˆ–é…ç½®å˜åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
  push:
    paths:
      - 'analyzer_V9.py'          # è„šæœ¬å˜åŠ¨
      - '.github/workflows/**'    # YMLå˜åŠ¨
      - 'portfolio.csv'           # å½“ä½ æ‰‹åŠ¨æ›´æ–°æŒä»“è´¦æœ¬æ—¶ä¹Ÿè¿è¡Œ

  # è§¦å‘æœºåˆ¶ 2ï¼šå®šæ—¶ä»»åŠ¡ï¼ˆåŒ—äº¬æ—¶é—´æ¯å¤© 15:45ï¼‰
  schedule:
    - cron: '45 7 * * *'         # UTC 07:45 = CST 15:45

  # è§¦å‘æœºåˆ¶ 3ï¼šæ”¯æŒæ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è¿è¡Œ
  workflow_dispatch: 

jobs:
  build_and_analyze:
    runs-on: ubuntu-latest
    permissions:
      contents: write            # èµ‹äºˆå†™å…¥æƒé™ï¼Œä»¥ä¾¿å°†ç»“æœæ¨é€å›ç›®å½•

    steps:
      - name: ğŸ“¥ 1. æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ 2. è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ› ï¸ 3. å®‰è£…å¿…å¤‡é‡‘èåº“
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy akshare

      - name: ğŸ“ˆ 4. æ‰§è¡Œå¤©æ¢æ ¸å¿ƒåˆ†æ
        run: python analyzer_V9.py

      - name: ğŸ’¾ 5. å°†åˆ†æç»“æœæ¨é€è‡³ç›®å½•
        run: |
          git config --global user.name "Sky-Pivot-Bot"
          git config --global user.email "actions@github.com"
          
          # å°†å˜åŠ¨çš„æ–‡ä»¶åŠ å…¥æš‚å­˜åŒº
          git add README.md portfolio.csv signal_performance_tracker.csv || true
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶æ›´æ–°ï¼Œæ— æ›´æ–°åˆ™é€€å‡º
          if [ -z "$(git status --porcelain)" ]; then
            echo "ğŸ“¢ ä»Šæ—¥çœ‹æ¿æ— å˜åŠ¨ï¼Œè·³è¿‡æ¨é€ã€‚"
            exit 0
          fi
          
          git commit -m "ğŸ“Š [è‡ªåŠ¨åˆ†æ] æ›´æ–°çœ‹æ¿ä¸å®æˆ˜è®°å½•: $(date +'%Y-%m-%d %H:%M')"
          
          # å¼ºåˆ¶æ‹‰å–è¿œç¨‹å˜åŠ¨é˜²æ­¢æ¨é€å†²çª
          git pull --rebase origin main
          git push origin main
